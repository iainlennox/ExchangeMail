@using MimeKit
@model IEnumerable<MimeMessage>

@if (Model != null && Model.Any())
{
    foreach (var message in Model)
    {
        var isRead = message.Headers.Contains("X-Is-Read");
        var dbId = message.Headers["X-Db-Id"];
        var isFocused = message.Headers.Contains("X-Is-Focused") && message.Headers["X-Is-Focused"] == "True";
        var from = message.From.ToString();
        var date = message.Date.ToString("ddd MM-dd");
        var folder = message.Headers.Contains("X-Folder") ? message.Headers["X-Folder"] : "Inbox";
        var isUrgent = message.Headers.Contains("X-Labels") && message.Headers["X-Labels"].Contains("Urgent");

        <div class="mail-list-item thread-message-item @(isRead ? "" : "fw-bold")" onclick="loadMessage('@dbId', this)"
    style="padding-left: 2rem; margin-left: 0; border-radius: 0;">

            <div class="d-flex w-100 justify-content-between align-items-center">
                <div class="d-flex align-items-center text-truncate" style="max-width: 70%;">
                    <strong class="mb-0 text-truncate me-2">@from</strong>
                </div>
                <small class="text-muted text-nowrap">@date</small>
            </div>

            <div class="d-flex w-100 justify-content-between align-items-center mt-1">
                <div class="text-truncate text-muted small" style="max-width: 80%;">
                    @(message.TextBody != null && message.TextBody.Length > 100 ? message.TextBody.Substring(0, 100) + "..." :
            message.TextBody)
                </div>
                @if (isUrgent)
                {
                    <span class="badge bg-danger rounded-pill ms-2">Urgent</span>
                }
            </div>
        </div>
    }
}
